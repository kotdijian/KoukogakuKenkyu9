### QGISによるラスタ画像のジオリファレンスとデジタルトレース

#### ジオリファレンス
（解説：[MIERUNE QGIS-LAB：QGISでジオリファレンスを行う方法](https://qgis.mierune.co.jp/posts/howto_use_georeferencer)）
- 読み込むラスタデータの座標系を読み込み先と合わせる
- 方法1：特定または任意の3点の座標を入力する
- 方法2：QGISのマップキャンパス上で取得する
- QGISで読み込み可能なラスタファイル形式：tiff、png、jpeg等


#### 実習1：既知の点を利用した画像のジオリファレンス
1. georefsample1.pngをダウンロードしておく
　- 武蔵国分寺跡第758次調査報告書より（https://sitereports.nabunken.go.jp/139935）
2. 新規プロジェクト作成、CRSはEPSG6677を指定
3. 地理院地図（標準地図または単色地図、全国最新写真）のレイヤを設定
  - 全国最新写真のタイルURL：https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg
  - ズームレベル14〜18、13以下ではランドサット衛星画像に切り替わる
4. 「レイヤー」メニューより「ジオリファレンサ」を起動
5. 「ラスタを開く」ボタン（左端）よりサンプル画像を開く
6. 「変換の設定」ボタン（歯車：左から7番ん目）をクリック
7. 「変換タイプ」を「ヘルマート」に設定　（解説は下記）
8. 「変換先CRS」をEPSG6677に設定
9. 「出力ファイル」で保存先・ファイル名・ファイル形式（tiff推奨）を設定、「OK」をクリック
10. 「点を追加」ボタン（左から8番目）をクリック、画面上に十字カーソルが表示される
11. サンプル画像上の十字記号をクリック
12. 「地図座標の入力」ウィンドウが開くのでX、Y座標値を入力する（サンプル画像では十字記号に隣接して表記してあります）
13. 座標入力欄の下のCRSを選択する（サンプル画像ではEPSG6677：国土座標IX系を選択）
14. 「ジオリファレンスを開始」（緑三角：左から2番目）をクリック
14. マップキャンパス上で結果を確認する

#### 実習2：地図上の位置合わせによるジオリファレンス
1. georefsample.pngをダウンロードしておく
2. ジオリファレンサで画像を開く
3. 「変換の設定」（実習1の6〜9と同じ）
4. マップキャンパスでキャンパスで指定したい地点付近をズーム
5. 「点を追加」ボタンをクリック
6. サンプル画像上の位置合わせ基準点（敷地境界など）をクリック
7. 「地図座標の入力」ウィンドウでCRSを選択する（サンプル画像ではEPSG6677：国土座標系IX系を選択）
8. 座標値は入力せず左下の「地図キャンパスから」をクリック
9. マップキャンパス上で位置合わせの対照点をクリック
10. 最低3点の位置合わせが完了したら「地図座標の入力」ウィンドウの「ジオリファレンスを開始」ボタンをクリックする
11. マップキャンパス上で結果を確認する

#### 共通事項：変換タイプ
- 線形：水平移動と拡大縮小のみ。最低2点の指定
- ヘルマート：水平移動と回転。最低2点の指定
- 多項式：水平移動、回転、剪断変形を行う。多項式１では3点、2では6点、3では10点の指定が必要
- 薄型スプライン：位置合わせ点に合致するようにラスタを変形させる。オルソ化されていない画像にも適用できる。最低で10点、精度向上のためにはより多くの点が必要
- 投影変換：マップキャンパスと画像を中心投影して変換する。オルソ化されていない画像にも適用できる。最低で4点必要

#### デジタルトレース
- QGISではイラストレーターやCADに準じた描画機能がある
- ポイント、ライン、ポリゴンを作成できる
- 作成した図形は地理空間座標を持った地物となる < ドローソフトやCADとの最大の違い

#### 共通事項：編集モード
1. トレースした図形を表示するレイヤを設定する：「レイヤ」メニューから「レイヤを作成」→「新規GeoPackageレイヤ」を選択
2. 「新規GeoPackageレイヤ」で「データベース」（ファイル名と保存先）、テーブル名（レイヤ名：データベースと同じで良い）、ジオメトリ型（ポイント、ライン、ポリゴン）を選択
3. 「新規属性」でデータベースのフィールドを設定、「属性リストに追加」をクリックする
4. データベーステーブルが完成したら「OK」（右下）をクリックする
5. メイン画面に戻り、作成したレイヤを選択、「レイヤ」メニューまたはツールボタンの「編集モードの切り替え」（鉛筆マーク）で、編集モードに入る
6. 「ポイント・ライン・ポリゴン地物を追加」ボタンをクリック（選択できるジオメトリ型はレイヤ設定による）
7. マップキャンパス上をクリックして図形を描画する
    
